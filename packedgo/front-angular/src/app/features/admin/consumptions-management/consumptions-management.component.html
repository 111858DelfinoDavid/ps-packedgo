<div class="management-container">
  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-brand">
      <button class="btn-back" routerLink="/admin/dashboard">
        <i class="bi bi-arrow-left"></i>
      </button>
      <i class="bi bi-cup-hot-fill"></i>
      <span>Gesti√≥n de Consumos</span>
    </div>
    <div class="navbar-user">
      <button class="btn btn-logout" (click)="logout()">
        <i class="bi bi-box-arrow-right"></i>
        Cerrar Sesi√≥n
      </button>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="management-content">
    
    <!-- Success/Error Alerts -->
    <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
      <i class="bi bi-check-circle-fill me-2"></i>
      {{ successMessage }}
      <button type="button" class="btn-close" (click)="successMessage = ''"></button>
    </div>

    <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      {{ errorMessage }}
      <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
    </div>

    <!-- Header Section -->
    <div class="header-section">
      <div class="header-left">
        <h1>Consumos</h1>
        <p>Administra los consumos y sus categor√≠as disponibles para los eventos</p>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <button 
        class="tab-button"
        [class.active]="activeTab === 'consumptions'"
        (click)="switchTab('consumptions')"
      >
        <i class="bi bi-cup-hot-fill"></i>
        Consumos
      </button>
      <button 
        class="tab-button"
        [class.active]="activeTab === 'categories'"
        (click)="switchTab('categories')"
      >
        <i class="bi bi-folder"></i>
        Categor√≠as
      </button>
    </div>

    <!-- CONSUMPTIONS TAB -->
    <div *ngIf="activeTab === 'consumptions'" class="tab-content">
      <div class="content-header">
        <div class="search-wrapper">
          <i class="bi bi-search"></i>
          <input 
            type="text" 
            class="form-control search-input"
            [(ngModel)]="searchTerm" 
            (input)="filterConsumptions()"
            placeholder="Buscar consumos..."
          />
        </div>
        <button class="btn btn-create" (click)="openConsumptionModal()">
          <i class="bi bi-plus-circle"></i>
          Nuevo Consumo
        </button>
      </div>

      <div *ngIf="isLoading" class="loading">Cargando...</div>

      <div *ngIf="!isLoading && filteredConsumptions.length === 0" class="empty-state">
        <p>No hay consumos disponibles</p>
        <button class="btn btn-primary" (click)="openConsumptionModal()">Crear primer consumo</button>
      </div>

      <div *ngIf="!isLoading && filteredConsumptions.length > 0" class="consumptions-grid">
        <div *ngFor="let consumption of filteredConsumptions" class="consumption-card">
          <div class="card-image">
            <img 
              *ngIf="consumption.imageUrl"
              [src]="consumption.imageUrl" 
              [alt]="consumption.name"
              (error)="handleImageError($event)">
            <div *ngIf="!consumption.imageUrl" class="placeholder-icon">
              üçî
            </div>
            <span class="status-badge" [class.inactive]="!consumption.active">
              {{ consumption.active ? 'Activo' : 'Inactivo' }}
            </span>
          </div>
          <div class="card-body">
            <h3 class="consumption-name">{{ consumption.name }}</h3>
            <p class="consumption-category">{{ getCategoryName(consumption.categoryId) }}</p>
            <p class="consumption-description">{{ consumption.description || 'Sin descripci√≥n' }}</p>
            <div class="consumption-price">${{ consumption.price }}</div>
          </div>
          <div class="card-actions">
            <button class="btn-icon btn-edit" (click)="openConsumptionModal(consumption)" title="Editar">
              ‚úèÔ∏è
            </button>
            <button class="btn-icon btn-delete" (click)="deleteConsumption(consumption.id!)" title="Eliminar">
              üóëÔ∏è
            </button>
          </div>
        </div>
      </div>
    </div>

  <!-- CATEGORIES TAB -->
  <div *ngIf="activeTab === 'categories'" class="tab-content">
    <div class="toolbar">
      <h2>Categor√≠as de Consumos</h2>
      <button class="btn btn-primary" (click)="openCategoryModal()">
        <span class="icon">‚ûï</span>
        Nueva Categor√≠a
      </button>
    </div>

    <div *ngIf="isLoading" class="loading">Cargando...</div>

    <div *ngIf="!isLoading && consumptionCategories.length === 0" class="empty-state">
      <p>No hay categor√≠as disponibles</p>
      <button class="btn btn-primary" (click)="openCategoryModal()">Crear primera categor√≠a</button>
    </div>

    <div *ngIf="!isLoading && consumptionCategories.length > 0" class="categories-list">
      <div *ngFor="let category of consumptionCategories" class="category-item">
        <div class="category-info">
          <h3>{{ category.name }}</h3>
          <p>{{ category.description || 'Sin descripci√≥n' }}</p>
        </div>
        <div class="category-status">
          <span class="status-indicator" [class.active]="category.active === true">
            {{ category.active === true ? '‚óè' : '‚óã' }}
          </span>
          <span>{{ category.active === true ? 'Activa' : 'Inactiva' }}</span>
        </div>
        <div class="category-actions">
          <button class="btn-icon" (click)="toggleCategoryStatus(category.id!)" title="Cambiar estado">
            {{ category.active ? 'üîí' : 'üîì' }}
          </button>
          <button class="btn-icon btn-edit" (click)="openCategoryModal(category)" title="Editar">
            ‚úèÔ∏è
          </button>
          <button class="btn-icon btn-delete" (click)="deleteCategory(category.id!)" title="Eliminar">
            üóëÔ∏è
          </button>
        </div>
      </div>
    </div>
  </div>
  
<!-- CONSUMPTION MODAL -->
<div *ngIf="showConsumptionModal" class="modal-overlay" (click)="closeConsumptionModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'Editar Consumo' : 'Nuevo Consumo' }}</h2>
        <button class="btn-close" (click)="closeConsumptionModal()">‚úñ</button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="consumption-name">Nombre *</label>
            <input 
              type="text" 
              id="consumption-name"
              [(ngModel)]="consumptionForm.name" 
              name="name"
              placeholder="Ej: Hamburguesa Cl√°sica"
              class="form-control"
              required>
          </div>

          <div class="form-group">
            <label for="consumption-category">Categor√≠a *</label>
            <select 
              id="consumption-category"
              [(ngModel)]="consumptionForm.categoryId" 
              name="categoryId"
              class="form-control"
              required>
              <option [value]="0">Seleccionar categor√≠a</option>
              <option *ngFor="let cat of activeConsumptionCategories" [value]="cat.id">
                {{ cat.name }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="consumption-price">Precio *</label>
            <input 
              type="number" 
              id="consumption-price"
              [(ngModel)]="consumptionForm.price" 
              name="price"
              placeholder="0.00"
              step="0.01"
              min="0"
              class="form-control"
              required>
          </div>

          <div class="form-group">
            <label for="consumption-description">Descripci√≥n</label>
            <textarea 
              id="consumption-description"
              [(ngModel)]="consumptionForm.description" 
              name="description"
              placeholder="Descripci√≥n del consumo..."
              class="form-control"
              rows="3"></textarea>
          </div>

          <div class="form-group">
            <label for="consumption-image">URL de Imagen</label>
            <input 
              type="url" 
              id="consumption-image"
              [(ngModel)]="consumptionForm.imageUrl" 
              name="imageUrl"
              placeholder="https://ejemplo.com/imagen.jpg"
              class="form-control">
          </div>

          <div class="form-group checkbox-group">
            <label>
              <input 
                type="checkbox" 
                [(ngModel)]="consumptionForm.active" 
                name="active">
              <span>Activo</span>
            </label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeConsumptionModal()">Cancelar</button>
        <button class="btn btn-primary" (click)="saveConsumption()" [disabled]="isLoading">
          {{ isLoading ? 'Guardando...' : 'Guardar' }}
        </button>
      </div>
    </div>
  </div>

  <!-- CATEGORY MODAL -->
  <div *ngIf="showCategoryModal" class="modal-overlay" (click)="closeCategoryModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'Editar Categor√≠a' : 'Nueva Categor√≠a' }}</h2>
        <button class="btn-close" (click)="closeCategoryModal()">‚úñ</button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="category-name">Nombre *</label>
            <input 
              type="text" 
              id="category-name"
              [(ngModel)]="categoryForm.name" 
              name="name"
              placeholder="Ej: Bebidas"
              class="form-control"
              required>
          </div>

          <div class="form-group">
            <label for="category-description">Descripci√≥n</label>
            <textarea 
              id="category-description"
              [(ngModel)]="categoryForm.description" 
              name="description"
              placeholder="Descripci√≥n de la categor√≠a..."
              class="form-control"
              rows="3"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeCategoryModal()">Cancelar</button>
        <button class="btn btn-primary" (click)="saveCategory()" [disabled]="isLoading">
          {{ isLoading ? 'Guardando...' : 'Guardar' }}
        </button>
      </div>
    </div>
  </div>
