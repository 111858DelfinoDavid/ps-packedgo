Lista de Bases de Datos y Tablas - PackedGo
Actualizado: Noviembre 2025 - Basado en c√≥digo real implementado

NOTA IMPORTANTE: Este documento refleja la estructura REAL de las entidades implementadas en el c√≥digo.
Las tablas marcadas con ‚è≥ est√°n pendientes de implementaci√≥n.
Las tablas marcadas con ‚ùå fueron eliminadas del dise√±o original.

================================================================================
1. auth_db (AUTH-SERVICE) - Puerto 8081
================================================================================
Base de datos: PostgreSQL (Puerto 5433)

Tabla: auth_users
-----------------
id - BIGSERIAL PRIMARY KEY
user_profile_id - BIGINT NOT NULL
username - VARCHAR(50) UNIQUE NOT NULL
email - VARCHAR(255) UNIQUE
document - BIGINT UNIQUE
password_hash - VARCHAR(255) NOT NULL
role - VARCHAR(20) NOT NULL DEFAULT 'CUSTOMER'
login_type - VARCHAR(20) NOT NULL DEFAULT 'DOCUMENT'
is_active - BOOLEAN DEFAULT TRUE
is_email_verified - BOOLEAN DEFAULT FALSE
is_document_verified - BOOLEAN DEFAULT FALSE
last_login - TIMESTAMP
failed_login_attempts - INTEGER DEFAULT 0
locked_until - TIMESTAMP
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP

Tabla: user_sessions
--------------------
id - BIGSERIAL PRIMARY KEY
auth_user_id - BIGINT REFERENCES auth_users(id)
session_token - VARCHAR(500) NOT NULL
refresh_token - VARCHAR(500)
device_info - VARCHAR(500)
ip_address - VARCHAR(100)
user_agent - VARCHAR(1000)
expires_at - TIMESTAMP NOT NULL
last_activity - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
is_active - BOOLEAN DEFAULT TRUE

Tabla: password_recovery_tokens
--------------------------------
id - BIGSERIAL PRIMARY KEY
auth_user_id - BIGINT REFERENCES auth_users(id)
token - VARCHAR(255) UNIQUE NOT NULL
expires_at - TIMESTAMP NOT NULL
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
used_at - TIMESTAMP
ip_address - VARCHAR(100)
is_used - BOOLEAN DEFAULT FALSE

Tabla: email_verification_tokens
---------------------------------
id - BIGSERIAL PRIMARY KEY
auth_user_id - BIGINT REFERENCES auth_users(id)
token - VARCHAR(255) UNIQUE NOT NULL
expires_at - TIMESTAMP NOT NULL
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
verified_at - TIMESTAMP
is_verified - BOOLEAN DEFAULT FALSE

Tabla: role_permissions
-----------------------
id - BIGSERIAL PRIMARY KEY
role - VARCHAR(20) NOT NULL
resource - VARCHAR(50) NOT NULL
action - VARCHAR(20) NOT NULL
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
UNIQUE(role, resource, action)

Tabla: login_attempts
---------------------
id - BIGSERIAL PRIMARY KEY
login_identifier - VARCHAR(255) NOT NULL
login_type - VARCHAR(20) NOT NULL
ip_address - VARCHAR(100) NOT NULL
user_agent - VARCHAR(1000)
success - BOOLEAN NOT NULL
failure_reason - VARCHAR(100)
attempted_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP


================================================================================
2. users_db (USERS-SERVICE) - Puerto 8082
================================================================================
Base de datos: PostgreSQL (Puerto 5434)

Tabla: user_profiles
--------------------
id - BIGSERIAL PRIMARY KEY
auth_user_id - BIGINT NOT NULL  (Vincula con auth_users)
name - VARCHAR(100) NOT NULL
last_name - VARCHAR(100) NOT NULL
gender - VARCHAR(10) NOT NULL  (Enum: MALE, FEMALE, OTHER)
document - BIGINT UNIQUE NOT NULL
born_date - DATE NOT NULL
telephone - BIGINT UNIQUE NOT NULL
profile_image_url - VARCHAR(500)
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
is_active - BOOLEAN DEFAULT TRUE

üÜï Tabla: employees (NUEVA)
---------------------------
id - BIGSERIAL PRIMARY KEY
email - VARCHAR(255) UNIQUE NOT NULL
username - VARCHAR(255) NOT NULL
password_hash - VARCHAR(255) NOT NULL
document - BIGINT UNIQUE NOT NULL
admin_id - BIGINT NOT NULL
is_active - BOOLEAN DEFAULT TRUE
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP

üÜï Tabla: employee_events (NUEVA)
---------------------------------
employee_id - BIGINT NOT NULL REFERENCES employees(id)
event_id - BIGINT NOT NULL
PRIMARY KEY (employee_id, event_id)

‚è≥ Tabla: user_addresses (PENDIENTE DE IMPLEMENTACI√ìN)
-------------------------------------------------------
id - BIGSERIAL PRIMARY KEY
user_profile_id - BIGINT REFERENCES user_profiles(id)
address_type - VARCHAR(20) DEFAULT 'HOME'
street - VARCHAR(255) NOT NULL
city - VARCHAR(100) NOT NULL
state - VARCHAR(100) NOT NULL
postal_code - VARCHAR(20)
country - VARCHAR(50) DEFAULT 'Argentina'
is_primary - BOOLEAN DEFAULT FALSE
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP

‚è≥ Tabla: user_preferences (PENDIENTE DE IMPLEMENTACI√ìN)
---------------------------------------------------------
id - BIGSERIAL PRIMARY KEY
user_profile_id - BIGINT REFERENCES user_profiles(id)
preference_key - VARCHAR(100) NOT NULL
preference_value - TEXT NOT NULL
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
UNIQUE(user_profile_id, preference_key)


================================================================================
3. events_db (EVENT-SERVICE) - Puerto 8086
================================================================================
Base de datos: PostgreSQL (Puerto 5435)

Tabla: event_categories
-----------------------
id - BIGSERIAL PRIMARY KEY
name - VARCHAR(255) NOT NULL
active - BOOLEAN DEFAULT TRUE

Tabla: events
-------------
id - BIGSERIAL PRIMARY KEY
category_id - BIGINT REFERENCES event_categories(id)
name - VARCHAR(255) NOT NULL
description - TEXT
event_date - TIMESTAMP NOT NULL
lat - DOUBLE PRECISION
lng - DOUBLE PRECISION
max_capacity - INTEGER
current_capacity - INTEGER DEFAULT 0
base_price - DECIMAL(10,2) NOT NULL
image_url - VARCHAR(500)
image_data - BYTEA [NUEVO]
image_content_type - VARCHAR(255) [NUEVO]
status - VARCHAR(20) DEFAULT 'ACTIVE'
created_by - BIGINT NOT NULL
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
active - BOOLEAN DEFAULT TRUE
total_passes - INTEGER NOT NULL DEFAULT 0
available_passes - INTEGER NOT NULL DEFAULT 0
sold_passes - INTEGER NOT NULL DEFAULT 0
version - BIGINT DEFAULT 0

Tabla: consumption_categories
------------------------------
id - BIGSERIAL PRIMARY KEY
name - VARCHAR(255) NOT NULL
active - BOOLEAN DEFAULT TRUE

Tabla: consumptions
-------------------
id - BIGSERIAL PRIMARY KEY
category_id - BIGINT REFERENCES consumption_categories(id)
name - VARCHAR(255) NOT NULL
description - TEXT
price - DECIMAL(10,2) NOT NULL
image_url - VARCHAR(500)
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
active - BOOLEAN DEFAULT TRUE

Tabla: passes
-------------
id - BIGSERIAL PRIMARY KEY
code - VARCHAR(50) UNIQUE NOT NULL
event_id - BIGINT NOT NULL REFERENCES events(id) ON DELETE CASCADE
active - BOOLEAN NOT NULL DEFAULT TRUE
available - BOOLEAN NOT NULL DEFAULT TRUE
sold - BOOLEAN NOT NULL DEFAULT FALSE
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
sold_at - TIMESTAMP
sold_to_user_id - BIGINT
version - BIGINT DEFAULT 0

Tabla: tickets
--------------
id - BIGSERIAL PRIMARY KEY
user_id - BIGINT NOT NULL
pass_id - BIGINT NOT NULL UNIQUE REFERENCES passes(id)
ticket_consumption_id - BIGINT NOT NULL UNIQUE REFERENCES consumption_tickets(id)
active - BOOLEAN NOT NULL DEFAULT TRUE
redeemed - BOOLEAN NOT NULL DEFAULT FALSE
qr_code - TEXT [NUEVO]
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
purchased_at - TIMESTAMP
redeemed_at - TIMESTAMP
version - BIGINT DEFAULT 0

Tabla: consumption_tickets
--------------------------
id - BIGSERIAL PRIMARY KEY
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
active - BOOLEAN DEFAULT TRUE
redeem - BOOLEAN DEFAULT FALSE
version - BIGINT DEFAULT 0

Tabla: ticket_consumption_details
---------------------------------
id - BIGSERIAL PRIMARY KEY
consumption_id - BIGINT NOT NULL REFERENCES consumptions(id)
consumption_ticket_id - BIGINT NOT NULL REFERENCES consumption_tickets(id) ON DELETE CASCADE
quantity - INTEGER NOT NULL
price_at_purchase - DECIMAL(10,2) NOT NULL
active - BOOLEAN DEFAULT TRUE
redeem - BOOLEAN DEFAULT FALSE
version - BIGINT DEFAULT 0


================================================================================
4. orders_db (ORDER-SERVICE) - Puerto 8084
================================================================================
Base de datos: PostgreSQL (Puerto 5436)

Tabla: shopping_carts
---------------------
id - BIGSERIAL PRIMARY KEY
user_id - BIGINT NOT NULL
event_id - BIGINT NOT NULL
status - VARCHAR(20) DEFAULT 'ACTIVE'
expires_at - TIMESTAMP
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP

Tabla: cart_items
-----------------
id - BIGSERIAL PRIMARY KEY
cart_id - BIGINT REFERENCES shopping_carts(id)
item_type - VARCHAR(20) NOT NULL
item_id - BIGINT NOT NULL
quantity - INTEGER NOT NULL DEFAULT 1
unit_price - DECIMAL(10,2) NOT NULL
total_price - DECIMAL(10,2) NOT NULL
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP

Tabla: orders
-------------
id - BIGSERIAL PRIMARY KEY
user_id - BIGINT NOT NULL
event_id - BIGINT NOT NULL
order_number - VARCHAR(50) UNIQUE NOT NULL
status - VARCHAR(30) DEFAULT 'PENDING_PAYMENT'
subtotal - DECIMAL(10,2) NOT NULL
taxes - DECIMAL(10,2) DEFAULT 0
total_amount - DECIMAL(10,2) NOT NULL
payment_id - BIGINT
payment_preference_id - VARCHAR(100) [NUEVO]
checkout_url - VARCHAR(500) [NUEVO]
session_id - VARCHAR(100) [NUEVO]
admin_id - BIGINT
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
paid_at - TIMESTAMP
cancelled_at - TIMESTAMP

Tabla: order_items
------------------
id - BIGSERIAL PRIMARY KEY
order_id - BIGINT REFERENCES orders(id)
event_id - BIGINT NOT NULL
event_name - VARCHAR(200) NOT NULL
quantity - INTEGER NOT NULL
unit_price - DECIMAL(10,2) NOT NULL
subtotal - DECIMAL(10,2) NOT NULL
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP


================================================================================
5. payments_db (PAYMENT-SERVICE) - Puerto 8085
================================================================================
Base de datos: PostgreSQL (Puerto 5432)

Tabla: payments
---------------
id - BIGSERIAL PRIMARY KEY
admin_id - BIGINT NOT NULL
order_id - VARCHAR(255) NOT NULL UNIQUE
amount - DECIMAL(10,2) NOT NULL
currency - VARCHAR(3) DEFAULT 'ARS'
status - VARCHAR(50) NOT NULL
payment_method - VARCHAR(100)
payer_email - VARCHAR(255)
payer_name - VARCHAR(255)
description - VARCHAR(500)
stripe_session_id - VARCHAR(255) [NUEVO]
stripe_payment_intent_id - VARCHAR(255) [NUEVO]
payment_provider - VARCHAR(50) DEFAULT 'STRIPE' [NUEVO]
transaction_amount - DECIMAL(10,2)
status_detail - VARCHAR(100)
payment_type_id - VARCHAR(50)
installments - INTEGER
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP
approved_at - TIMESTAMP

‚ùå Tabla: payment_transactions (ELIMINADA/NO IMPLEMENTADA)
‚ùå Tabla: mercadopago_webhooks (ELIMINADA/NO IMPLEMENTADA)
‚ùå Tabla: payment_methods (ELIMINADA/NO IMPLEMENTADA)


================================================================================
6. analytics_db (ANALYTICS-SERVICE) - Puerto 8087
================================================================================
Base de datos: PostgreSQL (Puerto 5439)

‚ö†Ô∏è NOTA: Este servicio actualmente calcula m√©tricas en memoria obteniendo datos
de otros microservicios (Event, Order, Payment) y no persiste datos propios
en una base de datos relacional en la implementaci√≥n actual.

‚è≥ Tabla: event_metrics (PENDIENTE)
‚è≥ Tabla: sales_reports (PENDIENTE)
‚è≥ Tabla: consumption_analytics (PENDIENTE)
‚è≥ Tabla: user_behavior_tracking (PENDIENTE)


================================================================================
RESUMEN DE CAMBIOS vs DOCUMENTACI√ìN ORIGINAL
================================================================================

‚úÖ MICROSERVICIOS IMPLEMENTADOS:
- auth-service (100% funcional)
- users-service (100% funcional, incluye empleados)
- event-service (100% funcional con nuevo modelo)
- order-service (100% funcional)
- payment-service (100% funcional con Stripe)
- analytics-service (Funcional, c√°lculo en memoria)

üÜï TABLAS NUEVAS:
1. employees (Users Service)
2. employee_events (Users Service)
3. events (campos de imagen agregados)
4. tickets (campo qr_code agregado)
5. orders (campos de Stripe agregados)
6. payments (adaptada para Stripe)

‚ùå TABLAS ELIMINADAS O REEMPLAZADAS:
1. Tablas espec√≠ficas de MercadoPago en Payment Service reemplazadas por campos de Stripe.

================================================================================
Documento actualizado: Noviembre 2025
Autores: David El√≠as Delfino, Agust√≠n Luparia Mothe
Universidad Tecnol√≥gica Nacional - Facultad Regional C√≥rdoba
================================================================================
