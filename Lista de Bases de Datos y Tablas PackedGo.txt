Lista de Bases de Datos y Tablas - PackedGo
Actualizado: Enero 2025 - Basado en c√≥digo real implementado

NOTA IMPORTANTE: Este documento refleja la estructura REAL de las entidades implementadas en el c√≥digo.
Las tablas marcadas con ‚è≥ est√°n pendientes de implementaci√≥n.
Las tablas marcadas con ‚ùå fueron eliminadas del dise√±o original.

================================================================================
1. auth_db (AUTH-SERVICE) - Puerto 8081
================================================================================
Base de datos: PostgreSQL (Puerto 5433)

Tabla: auth_users
-----------------
id - BIGSERIAL PRIMARY KEY
user_profile_id - BIGINT NOT NULL
username - VARCHAR(50) UNIQUE NOT NULL
email - VARCHAR(255) UNIQUE
document - BIGINT UNIQUE
password_hash - VARCHAR(255) NOT NULL
role - VARCHAR(20) NOT NULL DEFAULT 'CUSTOMER'
login_type - VARCHAR(20) NOT NULL DEFAULT 'DOCUMENT'
is_active - BOOLEAN DEFAULT TRUE
is_email_verified - BOOLEAN DEFAULT FALSE
is_document_verified - BOOLEAN DEFAULT FALSE
last_login - TIMESTAMP
failed_login_attempts - INTEGER DEFAULT 0
locked_until - TIMESTAMP
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP

Tabla: user_sessions
--------------------
id - BIGSERIAL PRIMARY KEY
auth_user_id - BIGINT REFERENCES auth_users(id)
session_token - VARCHAR(500) NOT NULL
refresh_token - VARCHAR(500)
device_info - VARCHAR(500)
ip_address - VARCHAR(100)  [CAMBIO: Era INET, ahora VARCHAR]
user_agent - VARCHAR(1000)
expires_at - TIMESTAMP NOT NULL
last_activity - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
is_active - BOOLEAN DEFAULT TRUE

Tabla: password_recovery_tokens
--------------------------------
id - BIGSERIAL PRIMARY KEY
auth_user_id - BIGINT REFERENCES auth_users(id)
token - VARCHAR(255) UNIQUE NOT NULL
expires_at - TIMESTAMP NOT NULL
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
used_at - TIMESTAMP
ip_address - VARCHAR(100)  [CAMBIO: Era INET, ahora VARCHAR]
is_used - BOOLEAN DEFAULT FALSE

Tabla: email_verification_tokens
---------------------------------
id - BIGSERIAL PRIMARY KEY
auth_user_id - BIGINT REFERENCES auth_users(id)
token - VARCHAR(255) UNIQUE NOT NULL
expires_at - TIMESTAMP NOT NULL
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
verified_at - TIMESTAMP
is_verified - BOOLEAN DEFAULT FALSE

Tabla: role_permissions
-----------------------
id - BIGSERIAL PRIMARY KEY
role - VARCHAR(20) NOT NULL
resource - VARCHAR(50) NOT NULL
action - VARCHAR(20) NOT NULL
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
UNIQUE(role, resource, action)

Tabla: login_attempts
---------------------
id - BIGSERIAL PRIMARY KEY
login_identifier - VARCHAR(255) NOT NULL
login_type - VARCHAR(20) NOT NULL
ip_address - VARCHAR(100) NOT NULL  [CAMBIO: Era INET, ahora VARCHAR]
user_agent - VARCHAR(1000)
success - BOOLEAN NOT NULL
failure_reason - VARCHAR(100)
attempted_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP


================================================================================
2. users_db (USERS-SERVICE) - Puerto 8082
================================================================================
Base de datos: PostgreSQL (Puerto 5434)

Tabla: user_profiles
--------------------
id - BIGSERIAL PRIMARY KEY
auth_user_id - BIGINT NOT NULL  (Vincula con auth_users)
name - VARCHAR(100) NOT NULL
last_name - VARCHAR(100) NOT NULL
gender - VARCHAR(10) NOT NULL  (Enum: MALE, FEMALE, OTHER)
document - BIGINT UNIQUE NOT NULL
born_date - DATE NOT NULL
telephone - BIGINT UNIQUE NOT NULL
profile_image_url - VARCHAR(500)
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
is_active - BOOLEAN DEFAULT TRUE

[NOTA: Campo 'preferences JSONB' fue eliminado]
[NOTA: Campo 'email' est√° comentado, se maneja en auth_users]

‚è≥ Tabla: user_addresses (PENDIENTE DE IMPLEMENTACI√ìN)
-------------------------------------------------------
id - BIGSERIAL PRIMARY KEY
user_profile_id - BIGINT REFERENCES user_profiles(id)
address_type - VARCHAR(20) DEFAULT 'HOME'
street - VARCHAR(255) NOT NULL
city - VARCHAR(100) NOT NULL
state - VARCHAR(100) NOT NULL
postal_code - VARCHAR(20)
country - VARCHAR(50) DEFAULT 'Argentina'
is_primary - BOOLEAN DEFAULT FALSE
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP

‚è≥ Tabla: user_preferences (PENDIENTE DE IMPLEMENTACI√ìN)
---------------------------------------------------------
id - BIGSERIAL PRIMARY KEY
user_profile_id - BIGINT REFERENCES user_profiles(id)
preference_key - VARCHAR(100) NOT NULL
preference_value - TEXT NOT NULL
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
UNIQUE(user_profile_id, preference_key)


================================================================================
3. events_db (EVENT-SERVICE) - Puerto 8083
================================================================================
Base de datos: PostgreSQL (Puerto 5435)

üÜï Tabla: event_categories (NUEVA - NO ESTABA DOCUMENTADA)
-----------------------------------------------------------
id - BIGSERIAL PRIMARY KEY
name - VARCHAR(255) NOT NULL
active - BOOLEAN DEFAULT TRUE

Tabla: events
-------------
id - BIGSERIAL PRIMARY KEY
category_id - BIGINT REFERENCES event_categories(id)  [NUEVO]
name - VARCHAR(255) NOT NULL
description - TEXT
event_date - TIMESTAMP NOT NULL
lat - DOUBLE PRECISION  [NUEVO - Latitud geogr√°fica]
lng - DOUBLE PRECISION  [NUEVO - Longitud geogr√°fica]
max_capacity - INTEGER
current_capacity - INTEGER DEFAULT 0
base_price - DECIMAL(10,2) NOT NULL
image_url - VARCHAR(500)
status - VARCHAR(20) DEFAULT 'ACTIVE'
created_by - BIGINT NOT NULL  [üîí CR√çTICO: Control multi-tenant]
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
active - BOOLEAN DEFAULT TRUE  [NUEVO]
total_passes - INTEGER NOT NULL DEFAULT 0  [NUEVO]
available_passes - INTEGER NOT NULL DEFAULT 0  [NUEVO]
sold_passes - INTEGER NOT NULL DEFAULT 0  [NUEVO]
version - BIGINT DEFAULT 0  [NUEVO - Optimistic locking]

[CAMBIO: Campo 'location VARCHAR' fue eliminado, reemplazado por lat/lng]

Tabla: consumption_categories
------------------------------
id - BIGSERIAL PRIMARY KEY
name - VARCHAR(255) NOT NULL  [CAMBIO: Era VARCHAR(100)]
active - BOOLEAN DEFAULT TRUE  [CAMBIO: Era 'is_active']

[CAMBIO: Campo 'description TEXT' fue eliminado]
[CAMBIO: Campo 'created_at' fue eliminado]

Tabla: consumptions
-------------------
id - BIGSERIAL PRIMARY KEY
category_id - BIGINT REFERENCES consumption_categories(id)
name - VARCHAR(255) NOT NULL
description - TEXT
price - DECIMAL(10,2) NOT NULL
image_url - VARCHAR(500)
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
active - BOOLEAN DEFAULT TRUE  [CAMBIO: Era 'is_active']

üÜï Tabla: passes (NUEVA - NO ESTABA DOCUMENTADA)
-------------------------------------------------
id - BIGSERIAL PRIMARY KEY
code - VARCHAR(50) UNIQUE NOT NULL
event_id - BIGINT NOT NULL REFERENCES events(id) ON DELETE CASCADE
active - BOOLEAN NOT NULL DEFAULT TRUE
available - BOOLEAN NOT NULL DEFAULT TRUE
sold - BOOLEAN NOT NULL DEFAULT FALSE
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
sold_at - TIMESTAMP
sold_to_user_id - BIGINT
version - BIGINT DEFAULT 0  (Optimistic locking)

DESCRIPCI√ìN: Entradas pre-generadas con c√≥digo √∫nico. Representan el "inventario" 
de entradas disponibles para un evento.

üÜï Tabla: tickets (NUEVA - NO ESTABA DOCUMENTADA)
--------------------------------------------------
id - BIGSERIAL PRIMARY KEY
user_id - BIGINT NOT NULL  (Referencia externa a auth_users)
pass_id - BIGINT NOT NULL UNIQUE REFERENCES passes(id)
ticket_consumption_id - BIGINT NOT NULL UNIQUE REFERENCES consumption_tickets(id)
active - BOOLEAN NOT NULL DEFAULT TRUE
redeemed - BOOLEAN NOT NULL DEFAULT FALSE  (Entrada canjeada al ingresar)
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
purchased_at - TIMESTAMP
redeemed_at - TIMESTAMP
version - BIGINT DEFAULT 0  (Optimistic locking)

DESCRIPCI√ìN: Asocia un Pass comprado con un usuario y su paquete de consumiciones.
Es el "ticket de compra" completo.

üÜï Tabla: consumption_tickets (NUEVA - NO ESTABA DOCUMENTADA)
--------------------------------------------------------------
id - BIGSERIAL PRIMARY KEY
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
active - BOOLEAN DEFAULT TRUE
redeem - BOOLEAN DEFAULT FALSE  (Todas las consumiciones canjeadas)
version - BIGINT DEFAULT 0  (Optimistic locking)

DESCRIPCI√ìN: Agrupa todas las consumiciones incluidas en un ticket.
Es el "paquete de consumiciones" del usuario.

üÜï Tabla: ticket_consumption_details (NUEVA - NO ESTABA DOCUMENTADA)
---------------------------------------------------------------------
id - BIGSERIAL PRIMARY KEY
consumption_id - BIGINT NOT NULL REFERENCES consumptions(id)
consumption_ticket_id - BIGINT NOT NULL REFERENCES consumption_tickets(id) ON DELETE CASCADE
quantity - INTEGER NOT NULL
price_at_purchase - DECIMAL(10,2) NOT NULL  (Precio hist√≥rico)
active - BOOLEAN DEFAULT TRUE
redeem - BOOLEAN DEFAULT FALSE  (Esta consumici√≥n espec√≠fica canjeada)
version - BIGINT DEFAULT 0  (Optimistic locking)

DESCRIPCI√ìN: Detalle individual de cada consumici√≥n incluida en un paquete.
Ejemplo: 2 cervezas + 1 hamburguesa = 2 registros en esta tabla.

‚ùå Tabla: event_consumptions (ELIMINADA)
-----------------------------------------
Esta tabla fue eliminada y reemplazada por el nuevo modelo:
Event ‚Üí Pass ‚Üí Ticket ‚Üí TicketConsumption ‚Üí TicketConsumptionDetail

‚ùå Tabla: stock_movements (ELIMINADA)
--------------------------------------
El control de stock ahora se maneja directamente en la tabla 'events'
mediante los campos: total_passes, available_passes, sold_passes


================================================================================
4. orders_db (ORDER-SERVICE) - Puerto 8084
================================================================================
Base de datos: PostgreSQL (Puerto 5436)

‚è≥ PENDIENTE DE IMPLEMENTACI√ìN

Tabla: shopping_carts
---------------------
id - BIGSERIAL PRIMARY KEY
user_id - BIGINT NOT NULL
event_id - BIGINT NOT NULL
status - VARCHAR(20) DEFAULT 'ACTIVE'
expires_at - TIMESTAMP
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP

Tabla: cart_items
-----------------
id - BIGSERIAL PRIMARY KEY
cart_id - BIGINT REFERENCES shopping_carts(id)
item_type - VARCHAR(20) NOT NULL
item_id - BIGINT NOT NULL
quantity - INTEGER NOT NULL DEFAULT 1
unit_price - DECIMAL(10,2) NOT NULL
total_price - DECIMAL(10,2) NOT NULL
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP

Tabla: orders
-------------
id - BIGSERIAL PRIMARY KEY
user_id - BIGINT NOT NULL
event_id - BIGINT NOT NULL
order_number - VARCHAR(50) UNIQUE NOT NULL
status - VARCHAR(20) DEFAULT 'PENDING'
subtotal - DECIMAL(10,2) NOT NULL
taxes - DECIMAL(10,2) DEFAULT 0
total - DECIMAL(10,2) NOT NULL
payment_id - BIGINT
qr_code_id - BIGINT
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
completed_at - TIMESTAMP

Tabla: order_items
------------------
id - BIGSERIAL PRIMARY KEY
order_id - BIGINT REFERENCES orders(id)
item_type - VARCHAR(20) NOT NULL
item_id - BIGINT NOT NULL
item_name - VARCHAR(255) NOT NULL
quantity - INTEGER NOT NULL
unit_price - DECIMAL(10,2) NOT NULL
total_price - DECIMAL(10,2) NOT NULL

Tabla: package_configurations
------------------------------
id - BIGSERIAL PRIMARY KEY
order_id - BIGINT REFERENCES orders(id)
package_name - VARCHAR(255)
total_entries - INTEGER DEFAULT 1
total_consumptions - INTEGER DEFAULT 0
package_discount - DECIMAL(5,2) DEFAULT 0
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP


================================================================================
5. payments_db (PAYMENT-SERVICE) - Puerto 8085
================================================================================
Base de datos: PostgreSQL (Puerto 5437)

‚è≥ PENDIENTE DE IMPLEMENTACI√ìN

Tabla: payments
---------------
id - BIGSERIAL PRIMARY KEY
order_id - BIGINT NOT NULL
user_id - BIGINT NOT NULL
payment_method - VARCHAR(50) NOT NULL
amount - DECIMAL(10,2) NOT NULL
currency - VARCHAR(5) DEFAULT 'ARS'
status - VARCHAR(20) DEFAULT 'PENDING'
mercadopago_payment_id - BIGINT
mercadopago_preference_id - VARCHAR(255)
external_reference - VARCHAR(255)
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
paid_at - TIMESTAMP
expires_at - TIMESTAMP

Tabla: payment_transactions
----------------------------
id - BIGSERIAL PRIMARY KEY
payment_id - BIGINT REFERENCES payments(id)
transaction_type - VARCHAR(20) NOT NULL
mp_transaction_id - BIGINT
amount - DECIMAL(10,2) NOT NULL
status - VARCHAR(20) NOT NULL
status_detail - VARCHAR(100)
payment_method_type - VARCHAR(50)
installments - INTEGER DEFAULT 1
transaction_date - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
raw_response - JSONB

Tabla: mercadopago_webhooks
----------------------------
id - BIGSERIAL PRIMARY KEY
webhook_id - VARCHAR(255)
topic - VARCHAR(50) NOT NULL
resource_id - BIGINT
payment_id - BIGINT REFERENCES payments(id)
processed - BOOLEAN DEFAULT FALSE
raw_data - JSONB NOT NULL
received_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
processed_at - TIMESTAMP

Tabla: payment_methods
----------------------
id - BIGSERIAL PRIMARY KEY
mp_method_id - VARCHAR(50) NOT NULL
name - VARCHAR(100) NOT NULL
payment_type - VARCHAR(20) NOT NULL
status - VARCHAR(20) DEFAULT 'ACTIVE'
installments_available - JSONB
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP


================================================================================
6. qr_validation_db (QR-SERVICE) - Puerto 8086
================================================================================
Base de datos: PostgreSQL (Puerto 5438)

‚è≥ PENDIENTE DE IMPLEMENTACI√ìN

Tabla: qr_codes
---------------
id - BIGSERIAL PRIMARY KEY
order_id - BIGINT NOT NULL
user_id - BIGINT NOT NULL
event_id - BIGINT NOT NULL
qr_code_data - VARCHAR(500) UNIQUE NOT NULL
qr_hash - VARCHAR(255) UNIQUE NOT NULL
status - VARCHAR(20) DEFAULT 'ACTIVE'
generated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
expires_at - TIMESTAMP
first_scan_at - TIMESTAMP
last_scan_at - TIMESTAMP

Tabla: entry_validations
-------------------------
id - BIGSERIAL PRIMARY KEY
qr_code_id - BIGINT REFERENCES qr_codes(id)
validator_user_id - BIGINT
validation_type - VARCHAR(20) DEFAULT 'ENTRY'
validation_result - VARCHAR(20) NOT NULL
validation_location - VARCHAR(255)
device_info - VARCHAR(500)
validated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
notes - TEXT

Tabla: consumption_redemptions
-------------------------------
id - BIGSERIAL PRIMARY KEY
qr_code_id - BIGINT REFERENCES qr_codes(id)
order_item_id - BIGINT NOT NULL
consumption_id - BIGINT NOT NULL
quantity_redeemed - INTEGER NOT NULL
redeemed_by_user_id - BIGINT
redemption_location - VARCHAR(255)
redeemed_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
notes - TEXT

Tabla: validation_logs
----------------------
id - BIGSERIAL PRIMARY KEY
qr_code_id - BIGINT REFERENCES qr_codes(id)
action_type - VARCHAR(20) NOT NULL
action_result - VARCHAR(20) NOT NULL
performed_by - BIGINT
ip_address - INET
user_agent - VARCHAR(500)
location_data - JSONB
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
additional_data - JSONB


================================================================================
7. analytics_db (ANALYTICS-SERVICE) - Puerto 8087
================================================================================
Base de datos: PostgreSQL (Puerto 5439)

‚è≥ PENDIENTE DE IMPLEMENTACI√ìN

Tabla: event_metrics
--------------------
id - BIGSERIAL PRIMARY KEY
event_id - BIGINT NOT NULL
metric_date - DATE NOT NULL
total_sales - DECIMAL(12,2) DEFAULT 0
total_tickets_sold - INTEGER DEFAULT 0
total_consumptions_sold - INTEGER DEFAULT 0
unique_buyers - INTEGER DEFAULT 0
attendance_rate - DECIMAL(5,2) DEFAULT 0
avg_package_value - DECIMAL(10,2) DEFAULT 0
most_popular_consumption_id - BIGINT
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
UNIQUE(event_id, metric_date)

Tabla: sales_reports
--------------------
id - BIGSERIAL PRIMARY KEY
report_type - VARCHAR(20) NOT NULL
event_id - BIGINT
period_start - DATE NOT NULL
period_end - DATE NOT NULL
total_revenue - DECIMAL(12,2) NOT NULL
total_orders - INTEGER NOT NULL
avg_order_value - DECIMAL(10,2) NOT NULL
generated_by - BIGINT NOT NULL
generated_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP
report_data - JSONB

Tabla: consumption_analytics
-----------------------------
id - BIGSERIAL PRIMARY KEY
event_id - BIGINT NOT NULL
consumption_id - BIGINT NOT NULL
analysis_date - DATE NOT NULL
units_sold - INTEGER DEFAULT 0
revenue_generated - DECIMAL(10,2) DEFAULT 0
redemption_rate - DECIMAL(5,2) DEFAULT 0
peak_sale_hour - INTEGER
customer_rating - DECIMAL(3,2)
UNIQUE(event_id, consumption_id, analysis_date)

Tabla: user_behavior_tracking
------------------------------
id - BIGSERIAL PRIMARY KEY
user_id - BIGINT NOT NULL
event_id - BIGINT
action_type - VARCHAR(50) NOT NULL
action_details - JSONB
session_id - VARCHAR(255)
ip_address - INET
user_agent - VARCHAR(500)
created_at - TIMESTAMP DEFAULT CURRENT_TIMESTAMP


================================================================================
RESUMEN DE CAMBIOS vs DOCUMENTACI√ìN ORIGINAL
================================================================================

‚úÖ MICROSERVICIOS IMPLEMENTADOS:
- auth-service (100% funcional)
- users-service (implementado, tablas adicionales pendientes)
- event-service (100% funcional con nuevo modelo)

‚è≥ MICROSERVICIOS PENDIENTES:
- order-service
- payment-service
- qr-service  
- analytics-service

üÜï TABLAS NUEVAS NO DOCUMENTADAS:
1. event_categories - Categorizaci√≥n de eventos
2. passes - Sistema de entradas pre-generadas
3. tickets - Asociaci√≥n compra-usuario-consumiciones
4. consumption_tickets - Paquete de consumiciones
5. ticket_consumption_details - Detalle de consumiciones

‚ùå TABLAS ELIMINADAS:
1. event_consumptions ‚Üí Reemplazada por modelo Pass/Ticket
2. stock_movements ‚Üí Simplificada en campos de Event

‚è≥ TABLAS PENDIENTES (documentadas pero no implementadas):
1. user_addresses
2. user_preferences

üîí CAMPO CR√çTICO PARA MULTI-TENANCY:
- events.created_by ‚Üí Permite aislamiento por organizador (SaaS)

üî¢ MODELO DE NUMERACI√ìN DE CAMPOS VERSION:
- Implementado en: events, passes, tickets, consumption_tickets, ticket_consumption_details
- Prop√≥sito: Optimistic locking para manejo de concurrencia

================================================================================
Documento actualizado: Enero 2025
Autores: David El√≠as Delfino, Agust√≠n Luparia Mothe
Universidad Tecnol√≥gica Nacional - Facultad Regional C√≥rdoba
================================================================================
